define("data",["module","jquery","backbone","utility","modernizr","sticky"],function(f,a,b,c,e,h){var g=b.Model.extend({isDevelopment:f.config().isDevelopment,_isCORSSupported:f.config().isCORSSupported(_),getServiceUrl:f.config().getServiceUrl,setServiceUrl:f.config().setServiceUrl,defaults:{method:null,format:"json",parameters:null,typefields:""},initialize:function(i,j){this.options=_.extend(this.defaults,this.options);this.options.method=this.get("Type");this.options.parameters=i.ID;b.Model.prototype.idAttribute="ID"},getSubCollection:function(l){if(this.children==null){this.children=new Array()}for(var k=0;k<this.children.length;k++){if(this.children[k][0]==l){return this.children[k][1]}}if(this.collection==null){this.collection=[]}var j=new d(this.get(l).rows,this.collection.options);b.Model.prototype.idAttribute="ID";this.children.push(new Array(l,j.models));return j.models},url:function(){if(this.doCORS()){return this.setServiceUrl+"/api/get/bo"}else{return"/rpc.ashx?eb=get/bo&host="+this.setServiceUrl}},_delete:function(j){var i=this;var k='{"ID":"'+this.id+'","Type":"'+this.get("Type")+'"}';var l=this.setServiceUrl+"/api/delete";if(!this.doCORS()){l="/rpc.ashx?eb=delete&host="+this.setServiceUrl}var m=a.ajax({url:l,type:"POST",data:k,dataType:"json",headers:{Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())},success:function(o){var n="<b>Delete Complete.</b>";if(o[0].Status=="OK"){if(a.isFunction(j.success)){j.success(o)}i.log("Deleted OK")}else{if(a.isFunction(j.error)){j.error(o)}i.log(o[0].Message);n="<b>Error! :(</b>"}if(j.notify!=false){a.sticky(n)}},error:function(n){if(a.isFunction(j.error)){j.error(n)}if(j.notify!=false){a.sticky("<b>Error!! :(</b>")}},complete:function(n,o){if("ShellApp" in window&&!c.isBlank(ShellApp)&&!c.isBlank(ShellApp.AnalyticsView)&&a.isFunction(ShellApp.AnalyticsView.track)){var p={ID:i.id};if(!c.isBlank(j.traits)&&a.isPlainObject(j.traits)&&!a.isEmptyObject(j.traits)&&!a.isFunction(j.traits)){p=a.extend(false,p,j.traits)}ShellApp.AnalyticsView.track("Deleted "+_.last(i.get("Type").split(".")),p)}}});return m},save:function(l){var k=this;var i=false;var n="";var j=this.get("IsNew");var m=JSON.stringify(this.changedAttributes());if(this.hasChanged()){i=true;n='{"ID":"'+this.id+'","IsNew":'+this.get("IsNew")+',"Type":"'+this.get("Type")+'",'+m.substring(1,m.length)}var o=this.setServiceUrl+"/api/set";if(!this.doCORS()){o="/rpc.ashx?eb=set&host="+this.setServiceUrl}if(i==true){var p=a.ajax({url:o,type:"POST",data:n,dataType:"json",headers:{Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())},beforeSend:function(q,r){if(a.isFunction(l.beforeSend)){l.beforeSend(q,r)}},success:function(r){var q="<b>Save Complete.</b>";k.set("IsNew",false);k._changing=false;if(r[0].Status=="OK"){if(a.isFunction(l.success)){l.success(r)}if("ShellApp" in window&&!c.isBlank(ShellApp)&&!c.isBlank(ShellApp.AnalyticsView)&&a.isFunction(ShellApp.AnalyticsView.track)){var s={ID:k.id};if(j){ShellApp.AnalyticsView.track("Created "+_.last(k.get("Type").split(".")),s)}else{ShellApp.AnalyticsView.track("Updated "+_.last(k.get("Type").split(".")),s)}}}else{if(a.isFunction(l.error)){l.error(r)}k.log(r[0].Message);q="<b>Error! :(</b>"}if(l.notify!=false){a.sticky(q)}},error:function(q){if(l.notify!=false){a.sticky("<b>Error!! :(</b>")}if(a.isFunction(l.error)){l.error(q)}},complete:function(q,r){if(a.isFunction(l.complete)){l.complete(q,r)}}});return p}else{if(a.isFunction(l.beforeSend)){l.beforeSend()}if(a.isFunction(l.success)){l.success()}if(a.isFunction(l.complete)){l.complete()}return null}},reset:function(i){this.clear();this.set(i);this.changed=null},fetch:function(j){j||(j={});var i=(j.data||{});if(this.doCORS()){j.crossDomain=true}j.data=JSON.stringify(this.options);j.contentType="application/json";j.type="POST";j.headers={Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())};return b.Collection.prototype.fetch.call(this,j)},doCORS:function(){return e.cors&&this._isCORSSupported},log:function(i){if(this.isDevelopment&&console){console.log(i)}}});var d=b.Collection.extend({model:g,isDevelopment:f.config().isDevelopment,initialize:function(i,j){this.options=_.extend(this.defaults,this.options);this.options.host=j.host;this.options.method=j.method;this.options.parameters=j.params;this.options.typefields=j.typefields;b.Model.prototype.idAttribute="ID"},_isCORSSupported:f.config().isCORSSupported(_),getServiceUrl:f.config().getServiceUrl,setServiceUrl:f.config().setServiceUrl,defaults:{method:null,format:"json",parameters:null,typefields:null},orderBy:function(j,i){var k;k=this.sortBy(function(l){if(typeof(l.get(j))==="string"){return l.get(j).toLowerCase()}else{return l.get(j)}});k.reverse();if(i=="desc"){k.reverse()}this.models=k},url:function(){if(this.doCORS()){if(c.isBlank(this.options.host)){return this.getServiceUrl.dashboard+"/api/get"}else{return this.getServiceUrl[this.options.host]+"/api/get"}}else{if(c.isBlank(this.options.host)){return"/rpc.ashx?eb=get&host="+this.getServiceUrl.dashboard}else{return"/rpc.ashx?eb=get&host="+this.getServiceUrl[this.options.host]}}},parse:function(j,i){if(j[0].Status!="OK"){if(a.isFunction(i.error)){i.error(j);this.log(j)}return[]}else{return j[1].rows}},fetch:function(j){j||(j={});var i=(j.data||{});j.data=JSON.stringify(this.options);if(e.cors){j.crossDomain=true}j.contentType="application/json";j.type="POST";j.headers={Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())};return b.Collection.prototype.fetch.call(this,j)},save:function(j){var i=this;var k=[];var l=new c.Queue;l.add(function(){return false});i.each(function(p,o){k.push(a.extend(false,{ID:p.get("ID"),IsNew:p.get("IsNew"),Type:p.get("Type")},p.changedAttributes()));if("ShellApp" in window&&!c.isBlank(ShellApp)&&!c.isBlank(ShellApp.AnalyticsView)&&a.isFunction(ShellApp.AnalyticsView.track)){var q={ID:p.id};if(p.get("IsNew")){l.add(function(){ShellApp.AnalyticsView.track("Created "+_.last(p.get("Type").split(".")),q);l.next()})}else{l.add(function(){ShellApp.AnalyticsView.track("Updated "+_.last(p.get("Type").split(".")),q);l.next()})}}});var m=this.setServiceUrl+"/api/save";if(!this.doCORS()){m="/rpc.ashx?eb=save&host="+this.setServiceUrl}var n=a.ajax({url:m,type:"POST",data:JSON.stringify(k),dataType:"json",headers:{Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())},beforeSend:function(o,p){if(a.isFunction(j.beforeSend)){j.beforeSend(o,p)}},success:function(p){var o="<b>Save Complete.</b>";i.each(function(r,q){r.set("IsNew",false)});i._changing=false;if(p[0].Status=="OK"){if(a.isFunction(j.success)){j.success(p)}}else{if(a.isFunction(j.error)){j.error(p)}i.log(p[0].Message);o="<b>Error! :(</b>"}if(j.notify!=false){a.sticky(o)}},error:function(o){if(j.notify!=false){a.sticky("<b>Error!! :(</b>")}if(a.isFunction(j.error)){j.error(o)}},complete:function(o,p){if(a.isFunction(j.complete)){j.complete(o,p)}l.next()}});return n},_delete:function(j){var i=this;var k=[];var l=new c.Queue;l.add(function(){return false});i.each(function(p,o){k.push({ID:p.get("ID"),Type:p.get("Type")});if("ShellApp" in window&&!c.isBlank(ShellApp)&&!c.isBlank(ShellApp.AnalyticsView)&&a.isFunction(ShellApp.AnalyticsView.track)){var q={ID:p.id};if(!c.isBlank(j.traits)&&a.isPlainObject(j.traits)&&!a.isEmptyObject(j.traits)&&!a.isFunction(j.traits)){q=a.extend(false,q,j.traits)}l.add(function(){ShellApp.AnalyticsView.track("Deleted "+_.last(p.get("Type").split(".")),q);l.next()})}});var m=this.setServiceUrl+"/api/remove";if(!this.doCORS()){m="/rpc.ashx?eb=remove&host="+this.setServiceUrl}var n=a.ajax({url:m,type:"POST",data:JSON.stringify(k),dataType:"json",headers:{Authorization:"Basic "+c.Base64.encode(c.User.getUserID()+":"+c.User.getAccessTokenID())},success:function(p){var o="<b>Delete Complete.</b>";if(p[0].Status=="OK"){if(a.isFunction(j.success)){j.success(p)}i.log("Deleted OK")}else{if(a.isFunction(j.error)){j.error(p)}i.log(p[0].Message);o="<b>Error! :(</b>"}if(j.notify!=false){a.sticky(o)}},error:function(o){if(a.isFunction(j.error)){j.error(o)}if(j.notify!=false){a.sticky("<b>Error!! :(</b>")}},complete:function(o,p){if(a.isFunction(j.complete)){j.complete(o,p)}l.next()}});return n},doCORS:function(){return e.cors&&this._isCORSSupported},log:function(i){if(this.isDevelopment&&console){console.log(i)}}});return{Model:g,Collection:d}});