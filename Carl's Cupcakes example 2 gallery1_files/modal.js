define("modal",["jquery","backbone","utility","text!/tpl.ashx?tpl=/_tpl/modal/dialog.html&host=uikit"],function(a,b,d,c){var e=b.View.extend({el:"body",cssClasses:{popup:".popup",popupBlock:".popup-block",popupHeaderBlock:".popup-title-block",popupContainer:".popup-container",popupButtonContainer:".popup-submit"},defaultOptions:{contentEl:"body",modalType:"dialog",autoOpen:true,autoResize:false,showOverlay:true,classNameModal:"",className:"",title:"Blank Title",subtitle:"Blank SubTitle",description:"",content:null,width:0,height:0,buttonAlign:"right",buttons:[{type:"success",text:"OK",cssClasses:"btn btn-primary",autoClose:true,isVisible:true,handler:a.noop},{type:"failure",text:"Cancel",cssClasses:"btn btn-danger",autoClose:true,isVisible:true,handler:a.noop}],close:{ESC:true,overlay:true},save:{ENTER:false},afterOpen:a.noop,beforeClose:a.noop,afterClose:a.noop,afterContentLoad:a.noop,getButton:function(g){var f=_.find(this.buttons,function(h){if(h.type===g){h.cssClasses=("isVisible" in h&&!h.isVisible)?h.cssClasses+" hide":h.cssClasses;return h}});return f},getButtonAlign:function(){return(this.buttonAlign.toLowerCase()==="left")?"modal-btn-left":((this.buttonAlign.toLowerCase()==="center")?"modal-btn-center":"modal-btn-right")}},_template:c,initialize:function(){this.options=_.extend({},this.defaultOptions,this.options);a(window).bind("resize",{me:this},this.resize);a(window).bind("keyup",{me:this},this.logKey);if(this.options.autoOpen){this.doOpen()}},render:function(){if(a(this.options.contentEl).children("div[id='modal']").length==0){a("<div/>").attr({id:"modal"}).appendTo(a(this.options.contentEl))}this.setElement("#modal");if(!d.isBlank(this.options.classNameModal)){this.$el.addClass(this.options.classNameModal)}this._template=(this.options.modalType.toLowerCase()==="dialog")?c:c;var f=_.template(this._template,this.options);var g=this;this.$el.append(f).hide().fadeIn("slow","swing",function(h){var l=g.$el.find(g.cssClasses.popup),m=g.$el.find(g.cssClasses.popupBlock),n=g.$el.find(g.cssClasses.popupContainer);if(g.options.width>0){m.css({maxWidth:g.options.width})}g.setContainerHeight();d.ActivityIndicator.show(l);if(g.options.modalType.toLowerCase()==="dialog"){if(a.isPlainObject(g.options.content)&&!d.isBlank(g.options.content.url)){var k=g.options.content.onSuccess,j=g.options.content.onError,o=function(r,q){d.ActivityIndicator.hide();k(r,q);g.onContentLoad()},i=function(q,r){d.ActivityIndicator.hide();j(q,r)};g.options.content.onSuccess=o;g.options.content.onError=i;g.options.content.el=a(g.cssClasses.popupContainer);this.xhr=d.Proxy.send(g.options.content)}else{if(d.isURL(g.options.content)){if(d.Social.isYoutubeURL(g.options.content)){a(g.cssClasses.popupContainer).append(a("<iframe/>").attr({src:d.Social.getYoutubeEmbed(g.options.content),width:"100%",height:"100%"}).bind("load",function(q){d.ActivityIndicator.hide();g.onContentLoad()}))}else{if(false){}else{if(false){}else{a(g.cssClasses.popupContainer).append(a("<iframe/>").attr({src:g.options.content,width:"100%",height:"100%",frameborder:"0",allowtransparency:"true"}).bind("load",function(q){d.ActivityIndicator.hide();g.onContentLoad()}))}}}}else{if(_.isElement(g.options.content[0])){d.ActivityIndicator.hide();a(g.cssClasses.popupContainer).append(g.options.content[0]);g.onContentLoad()}}}}else{var p=window.setTimeout("MO.ActivityIndicator.hide()",500);g.onContentLoad()}if(a.isFunction(g.options.afterOpen)){g.options.afterOpen(g)}g.scrollTo(0,0)});return this},events:{"click .overlay":"logClick","click .popup-close":"doClose","click button[data-type='success']":"clickSuccess","click button[data-type='failure']":"clickFailure"},destroy:function(){var f=this;a(f.options.contentEl).removeClass("no-overflow");if(a.isFunction(f.options.beforeClose)){f.options.beforeClose(f)}if(a.isFunction(f.options.afterClose)){f.options.afterClose(f)}if(!d.isBlank(f.xhr)){f.xhr.abort()}a(window).unbind("resize",f.resize);a(window).unbind("keyup",f.logKey);f.remove()},resize:function(f){var g=f.data.me;if(g.options.autoResize){g.setContainerHeight()}},setContainerHeight:function(){var f=this;if(f.options.modalType==="dialog"){var h=f.$el.find(f.cssClasses.popup),i=f.$el.find(f.cssClasses.popupBlock),k=f.$el.find(f.cssClasses.popupContainer),j=f.$el.find(f.cssClasses.popupButtonContainer),l=(a(window).height()-(i.position().top*2)-d.pixels(i,"paddingTop")-d.pixels(i,"paddingBottom")-k.position().top-d.pixels(j,"height")),g;if(f.options.height==0){g={height:l}}else{if(f.options.height>l){g={height:l}}else{g={height:f.options.height}}k.css(g)}}},scrollTo:function(g,h){var f=this;if("FB" in window){FB.Canvas.scrollTo(g,h)}},logKey:function(f){var g=f.data.me;if(g.options.close.ESC&&d.isESC(f)){g.doClose(f,true)}if(g.options.save.ENTER&&d.isENTER(f)){g.clickSuccess(f)}},logClick:function(f){if(this.options.close.overlay){this.doClose(f,true)}},doOpen:function(){this.render();a(this.options.contentEl).addClass("no-overflow");a("#big-video-wrap").hide();return this},doClose:function(g,f){a("#big-video-wrap").show();if(d.isUndefined(g)&&d.isUndefined(f)){return this.destroy()}else{if(d.isBlank(f)&&a(g.target).data("autoclose")){return this.destroy()}else{if(f){return this.destroy()}}}},onContentLoad:function(){this.$el.find(this.cssClasses.popupBlock).removeClass("hidden").addClass("visible");if(a.isFunction(this.options.afterContentLoad)){this.options.afterContentLoad(this)}},clickSuccess:function(g){var f=this.options.getButton("success").handler(g,this.$el.find(this.cssClasses.popupContainer),this);if(!d.isUndefined(f)){if(f){this.doClose(g,(d.isUndefined(this.options.getButton("success").autoClose))?true:this.options.getButton("success").autoClose)}}else{this.doClose(g,(d.isUndefined(this.options.getButton("success").autoClose))?true:this.options.getButton("success").autoClose)}},clickFailure:function(g){var f=this.options.getButton("failure").handler(g,this.$el.find(this.cssClasses.popupContainer),this);if(!d.isUndefined(f)){if(f){this.doClose(g,d.isUndefined(this.options.getButton("failure").autoClose)?true:this.options.getButton("failure").autoClose)}}else{this.doClose(g,d.isUndefined(this.options.getButton("failure").autoClose)?true:this.options.getButton("failure").autoClose)}},setTitle:function(f){if(d.isString(f)&&!d.isBlank(this.options.title)){this.options.title=f;this.$el.find(this.cssClasses.popupHeaderBlock).find("h3").html(f);return true}else{return false}},setSubtitle:function(f){if(d.isString(f)&&!d.isBlank(this.options.subtitle)){this.options.subtitle=f;this.$el.find(this.cssClasses.popupHeaderBlock).find("p").html(f);return true}else{return false}},setDescription:function(f){if(d.isString(f)&&!d.isBlank(this.options.description)){this.options.description=f;this.$el.find(this.cssClasses.popupHeaderBlock).find("span").text(f);return true}else{return false}},showButton:function(f){if(f>=0&&f<this.options.buttons.length){this.options.buttons[f].isVisible=true;a(this.$el.find(this.cssClasses.popupButtonContainer).find("button")[f]).removeClass("hide")}},hideButton:function(f){if(f>=0&&f<this.options.buttons.length){this.options.buttons[f].isVisible=true;a(this.$el.find(this.cssClasses.popupButtonContainer).find("button")[f]).addClass("hide")}},setButtonAlign:function(f){if(d.isString(f)){var g=(f.toLowerCase()==="left")?"modal-btn-left":((f.toLowerCase()==="center")?"modal-btn-center":"modal-btn-right");this.options.buttonAlign=g;a(this.$el.find(this.cssClasses.popupButtonContainer).find("div")).removeClass("modal-btn-left modal-btn-center modal-btn-right").addClass(g)}},setButtonText:function(f,g){if(f>=0&&f<this.options.buttons.length&&d.isString(g)){this.options.buttons[f].text=g;a(this.$el.find(this.cssClasses.popupButtonContainer).find("button")[f]).text(g)}}});return e});