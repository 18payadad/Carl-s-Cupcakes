define("kenburns",["jquery"],function(a){(function(b){b.fn.kenburned=function(w){var c=b(this);var f=this[0].getContext("2d");var B=null;var D=c.width();var o=c.height();var p=w.images;var F=1/(w.zoom||2);var e=w.background_color||"#000000";var g=w.display_time||7000;var i=Math.min(g/2,w.fade_time||1000);var A=g-(i*2);var h=i-g;var l=w.frames_per_second||30;var k=(1/l)*1000;var v;var t=0;var q=[];u();function u(){q=[];b(p).each(function(G,H){q.push({path:H,initialized:false,loaded:false})})}function y(){B=null;g=w.display_time||7000;i=Math.min(g/2,w.fade_time||1000);A=g-(i*2);h=i-g}function n(){var G=new Date();return G.getTime()-B}function r(H,J,I,K,G){return{x:H+(I-H)*G,y:J+(K-J)*G}}function s(K,L,H){var I,J;try{I=r(K[0],K[1],L[0],L[1],H);J=r(K[2],K[3],L[2],L[3],H);return[I.x,I.y,J.x,J.y]}catch(G){return[0,0,0,0]}}function z(J,K){var N=J[2]-J[0];var I=J[3]-J[1];var G=(J[2]+J[0])/2;var H=(J[3]+J[1])/2;var M=N*K;var L=I*K;return[G-M/2,H-L/2,G+M/2,H+L/2]}function j(L,K,I,H){var G=I/H;var M=K*G;var J=K;if(M>L){M=L;J=L/G}var N=(L-M)/2;var O=(K-J)/2;return[N,O,N+M,O+J]}function m(H,J){var I=q[H];if(I.path.indexOf(".mp4")<0){if(!I.initialized){var G=new Image();I.image=G;I.loaded=false;G.onload=function(){I.loaded=true;var P=G.width;var O=G.height;var Q=j(P,O,D,o);var R=z(Q,F);var M=Math.floor(Math.random()*3)-1;var N=Math.floor(Math.random()*3)-1;M/=2;N/=2;var S=R[0];R[0]+=S*M;R[2]+=S*M;var T=R[1];R[1]+=T*N;R[3]+=T*N;if(H%2){I.r1=Q;I.r2=R}else{I.r1=R;I.r2=Q}if(J){J()}};I.initialized=true;G.src=I.path}}else{if(!I.initialized){var L=document.createElement("video");b(L).addClass("kenburns_videoSlideShow");b(L).addClass("kenburns_videoIndex_"+H);b(L).addClass("animHide");L.setAttribute("autoplay","");L.setAttribute("controls","");L.muted=true;var K=document.createElement("source");K.type="video/mp4";K.src=I.path;L.appendChild(K);I.video=L;L.oncanplay=function(){};I.initialized=true;b(".videoslideshow").append(L);if(J){J()}}}return I}function x(J,G,I){try{if(++t===1){b(".preloader").fadeOut(500);c.hide().fadeIn(2000,function(){})}if(G>1){return}var K=m(J);if(K.loaded){if(b("video[class*=kenburns_videoIndex_].animShow").length>0){c.show();b(".videoslideshow video").toggleClass("animShow",false).toggleClass("animHide",true).hide()}var L=s(K.r1,K.r2,G);var M=Math.min(1,I);if(M>0){f.save();f.globalAlpha=Math.min(1,M);f.drawImage(K.image,L[0],L[1],L[2]-L[0],L[3]-L[1],0,0,D,o);f.restore()}}else{if(q[J].path.indexOf(".mp4")>-1&&!(b(".kenburns_videoIndex_"+J).hasClass("animShow"))){var K=m(J);d();b(".kenburns_videoIndex_"+J).toggleClass("animShow",true).toggleClass("animHide",false).show();b(".videoslideshow").show();b(q[J].video)[0].play()}}}catch(H){}}function d(){f.save();f.globalAlpha=1;f.fillStyle=e;f.fillRect(0,0,f.canvas.width,f.canvas.height);f.restore()}function C(){var N=n();var M=Math.floor(N/(g-i));var J=M*(g-i);var L=N-J;if(L<i){var G=M-1;var H=J-g+i;var I=N-H;if(N<i){d()}else{x(E(G),I/g,1)}}x(E(M),L/g,L/i);if(w.post_render_callback){w.post_render_callback(c,f)}var K=E(M+1);m(K)}function E(G){return(G+q.length)%q.length}m(0,function(){B=n();v=setInterval(C,k)});return{utils:{fadeOut:function(G){c.fadeOut(G)},fadeIn:function(){c.fadeIn(1000)}},reload:u,resize:function(H,G){c.attr("width",H);c.attr("height",G);D=c.width=H;o=c.height=G;this.reload()},nextSlide:function(){var G=Math.floor(n()/(g-i));var H=this;this.utils.fadeOut(function(){clearInterval(v);m(E(G+1));var J=[];for(var I=q.length-1;I>G;I--){J.push(q.pop())}J.reverse();q=J.concat(q);y();B=n();v=setInterval(C,k);H.utils.fadeIn()})},prevSlide:function(){var G=Math.floor(n()/(g-i));var H=this;this.utils.fadeOut(function(){clearInterval(v);m(E(G-1));var J=[];for(var I=0;I<E(G-1);I++){J.push(q.shift())}q=q.concat(J);y();B=n();v=setInterval(C,k);H.utils.fadeIn()})},reset_images:function(G){p=G;clearInterval(v);q=[];b(p).each(function(H,I){q.push({path:I,initialized:false,loaded:false})});m(0,function(){B=n();v=setInterval(C,k)})},stop:function(){clearInterval(v)}}}})(a);return a.fn.kenburned});