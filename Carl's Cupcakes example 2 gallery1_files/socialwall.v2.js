define("socialwallv2",["jquery","backbone","underscorestring","utility","data","isotope","text!/tpl.ashx?tpl=/_tpl/modules/socialwall/v2/tile.html&host=websiteoutput"],function(a,c,b,h,j,g,p){var f=parseInt(new Date().getTime(),10);var l=c.Model.extend({defaults:{id:"",page_name:"",wallname:"",title:"",image:"",post_url:"",description:"",likecount:"",commentcount:"",posteddate:"",postedtimediff:"",isprime:false,page_url:"",rendered:false,isDuplicate:false,fbPoints:"",twitterPoints:"",linkedInPoints:""},initialize:function(){var q=f-this.get("posteddate");q=q/1000;q=q/60;if(q>60){q=q/60;if(q>24){q=q/24;if(q>30){q=q/30;if(q>12){q=q/12;if(q>10){this.set("postedtimediff","10+ y ago")}else{this.set("postedtimediff",Math.floor(q)+" y ago")}}else{this.set("postedtimediff",Math.floor(q)+" mo ago")}}else{this.set("postedtimediff",Math.floor(q)+" d ago")}}else{this.set("postedtimediff",Math.floor(q)+" h ago")}}else{this.set("postedtimediff",Math.floor(q)+" mins ago")}this.set("likecount",parseInt(this.get("likecount")))}});var m=c.Collection.extend({model:l});var k=c.Collection.extend({model:l});var d=c.Model.extend({defaults:{id:-1,PhotoTextBlackBar:0,HoverPhototext:0,NoPhotoText:0}});var e=c.Collection.extend({model:d});var o=c.View.extend({el:null,socialCollection:null,charCollection:new e(),iso:null,browserType:"",fbRequestSuccess:true,pinRequestSuccess:true,instaRequestSuccess:true,gplusRequestSuccess:true,youtubeRequestSuccess:true,twitterRequestSuccess:true,defaultOptions:{SitePageModuleID:null,FacebookPageID:"",PinterestPageID:"",InstagramPageID:"",InstagramClientID:"",FacebookPageURL:"",PinterestPageURL:"",InstagramPageURL:"",GooglePlusPageID:"",GooglePlusPageURL:"",YouTubePageID:"",YouTubePageURL:"",TwitterPageID:"",TwitterPageURL:"",FacebookPoints:"",TwitterPoints:"",LinkedInPoints:"",ContainerWidth:"",RangeClass:"",RangeNumber:0,RowToRender:0,TotalFeedsneedtoShow:0,totalPostRows:0,visibleRows:0,socialCollection:null},events:{},initialize:function(){var q=this;q.options=_.extend({},q.defaultOptions,q.options);q.setElement(".mod-socialwall-"+q.options.SitePageModuleID);q.socialCollection=new m();q.socialCollection.comparator=function(r){return r.get("posteddate")};q.pinterestTempCollection=new k();q.pinterestTempCollection.comparator=function(r){return r.get("posteddate")};q.populate();q.browserSpecific();q.$el.find(".social-wide").addClass(q.getRange());q.render();a(window).bind("resize",{me:q},q.resize)},resize:function(q){var r=q.data.me;if(r.browserType=="ie8"&&a(window).width()<480){r.$el.find(".isotope").toggleClass("ieToggleSmall",true)}else{r.$el.find(".isotope").toggleClass("ieToggleSmall",false)}r.resetRange(q)},resetRange:function(q){var r=this;r.$el.find(".social-wide").removeClass(function(t,s){return(s.match(/(^|\s)item-\S+/g)||[]).join(" ")});r.$el.find(".social-wide").addClass(r.getRange());r.HideShowPostPerRow()},browserSpecific:function(){var r=this;if((/android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()))){r.$el.addClass("mobileController")}var s=navigator.userAgent.toLowerCase(),q="",t=0;if(s.toLowerCase().indexOf("msie 9.0;")>=0){r.browserType="ie9"}else{if(s.toLowerCase().indexOf("msie 8.0;")>=0){r.browserType="ie8"}}if(r.$el.hasClass("browserie8")){r.browserType="ie8"}else{if(r.$el.hasClass("browserie9")){r.browserType="ie9"}}if(r.browserType=="ie8"){r.$el.find(".isotope").addClass("ieToggle");require(["backgroundie8"],function(){a(".itemImage").css({backgroundSize:"cover"})});if(a(window).width()<480){r.$el.find(".isotope").toggleClass("ieToggleSmall",true)}else{r.$el.find(".isotope").toggleClass("ieToggleSmall",false)}}},render:function(){var q=this;q.$el.find("#social-spinner").show();q.$el.find("#social-spinner").ActivityIndicator();q.getSocialCollection()},populate:function(){var q=this;q.charCollection.reset();q.charCollection.add(new d({id:1,PhotoTextBlackBar:20,HoverPhototext:44,NoPhotoText:80}));q.charCollection.add(new d({id:2,PhotoTextBlackBar:18,HoverPhototext:64,NoPhotoText:64}));q.charCollection.add(new d({id:3,PhotoTextBlackBar:25,HoverPhototext:80,NoPhotoText:80}));q.charCollection.add(new d({id:4,PhotoTextBlackBar:25,HoverPhototext:56,NoPhotoText:56}))},getRange:function(){var r=this;var q=(/android|iphone|ipod|android/i.test(navigator.userAgent.toLowerCase()));r.options.ContainerWidth=r.$el.find("#social-items-wrapper").parent().width();if(q){r.options.RangeClass="item-one";r.options.RangeNumber=4;r.options.TotalFeedsneedtoShow=4}else{if(r.options.ContainerWidth<=500){r.options.RangeClass="item-one";r.options.RangeNumber=1}else{if(r.options.ContainerWidth>=501&&r.options.ContainerWidth<=800){r.options.RangeClass="item-two";r.options.RangeNumber=2}else{if(r.options.ContainerWidth>=801&&r.options.ContainerWidth<=1200){r.options.RangeClass="item-three";r.options.RangeNumber=3}else{if(r.options.ContainerWidth>=1201&&r.options.ContainerWidth<=1920){r.options.RangeClass="item-four";r.options.RangeNumber=4}else{if(r.options.ContainerWidth>=1921&&r.options.ContainerWidth<=2500){r.options.RangeClass="item-five";r.options.RangeNumber=5}else{if(r.options.ContainerWidth>=2501){r.options.RangeClass="item-six";r.options.RangeNumber=6}}}}}}if((r.options.RowToRender>0)&&(r.options.RangeNumber>0)){r.options.TotalFeedsneedtoShow=r.options.RowToRender*r.options.RangeNumber}else{if(r.options.RowToRender==0){r.options.TotalFeedsneedtoShow=r.$el.find(".item").length}}}return r.options.RangeClass},getSocialCollection:function(){var q=this;q.getFacebookCollection(function(){q.getTwitterCollection(function(){q.getPinterestCollection(function(){q.getGooglePlusCollection(function(){q.getInstagramCollection(function(){q.getYouTubeCollection(function(){q.RenderTilePostItems()})})})})})})},HideShowPostPerRow:function(){var q=this;var r=0;q.options.ContainerWidth=q.$el.find("#social-items-wrapper").parent().width();q.$el.find(".item").each(function(){a(this).removeClass("hide")});if(q.options.TotalFeedsneedtoShow>0){q.$el.find(".item").each(function(){if(r>(q.options.TotalFeedsneedtoShow-1)){a(this).addClass("hide")}r+=1})}},RenderTilePostItems:function(){var q=this;q.socialCollection.each(function(t,r,s){t.set("RangeClass",q.options.RangeClass);var u=new n({model:t,browserType:q.browserType,OwnerView:q});q.$el.find(".isotope").prepend(u.render().$el)});q.updateFBPhotos();q.HideShowPostPerRow()},getFacebookCollection:function(r){var s=this;if(!h.isBlank(s.options.FacebookPageID)){var q="FacebookPageID="+s.options.FacebookPageID;s.fbdata=new j.Collection([],{host:"websiteoutput",method:"GetFBClientFeedResponse",params:q,typefields:[{DataType:"BOCollection",Columns:"*"}]});s.fbRequestSuccess=false;s.fbdata.fetch({success:function(u,v,t){s.fbRequestSuccess=true;if(u.length>0){s.fbdata.each(function(x,y){var A=f;if(s.browserType=="ie8"){A=parseInt(new Date(x.get("created_time")).getTime(),10)}else{A=parseInt(new Date(x.get("created_time")).getTime(),10)}var z=x.get("feedid");if(z!=""){z=z.split("_");if(z.length>1){z="https://www.facebook.com/"+s.options.FacebookPageID+"/posts/"+z[1]}else{z=x.get("post_url")}}if(a.trim(x.get("message"))!=""||a.trim(x.get("picture"))!=""){var w=new l({id:x.get("feedid"),page_name:x.get("name"),wallname:"facebook",title:x.get("message"),image:(h.Device.detectGooglePageSpeedInsights()?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(x.get("picture")):x.get("picture")),description:"",post_url:z,likecount:x.get("like_cnt"),commentcount:x.get("comment_cnt"),posteddate:A,page_url:s.options.FacebookPageURL,isprime:false,istext:(a.trim(x.get("picture"))==""&&a.trim(x.get("message"))!=""),fbPoints:s.options.FacebookPoints,twitterPoints:s.options.TwitterPoints,linkedInPoints:s.options.LinkedInPoints});if(s.socialCollection.where({title:w.attributes.title}).length==0){s.socialCollection.add(w)}}})}s.removeLoadingSpinner();if(a.isFunction(r)){r()}},error:function(t,u){if(a.isFunction(r)){r()}}})}else{if(a.isFunction(r)){r()}}},getTwitterCollection:function(r){var s=this;if(!h.isBlank(s.options.TwitterPageID)){var q="TwitterPageID="+s.options.TwitterPageID;s.twitterdata=new j.Collection([],{host:"websiteoutput",method:"GetTwitterClientFeedResponse",params:q,typefields:[{DataType:"BOCollection",Columns:"*"}]});s.twitterRequestSuccess=false;s.twitterdata.fetch({success:function(u,v){s.twitterRequestSuccess=true;if(v.length>1){var t=a.parseJSON(v[1]);a.each(t,function(x,y){if(x<10){var z=f;z=y.created_at.replace("+0000","UTC");z=parseInt(new Date(z).getTime(),10);var w="";if(y.hasOwnProperty("extended_entities")){w=y.extended_entities.media[0].media_url_https}var A=new l({id:(!h.isBlank(y.id_str))?y.id_str:"",wallname:"twitter",page_name:(!h.isBlank(y.user.name))?y.user.name:"",title:(!h.isBlank(y.text))?y.text:"",image:(!h.isBlank(w))?(h.Device.detectGooglePageSpeedInsights()?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(w):w):"",description:(!h.isBlank(y.text))?y.text:"",post_url:"https://twitter.com/"+s.options.TwitterPageID+"/status/"+y.id_str,likecount:(!h.isBlank(y.favorite_count))?y.favorite_count:0,commentcount:(!h.isBlank(y.retweet_count))?y.retweet_count:0,posteddate:(!h.isBlank(z))?z:"",page_url:s.options.TwitterPageURL,isprime:false,istext:(a.trim(w)==""&&a.trim(y.text)!=""),fbPoints:s.options.FacebookPoints,twitterPoints:s.options.TwitterPoints,linkedInPoints:s.options.LinkedInPoints});if(s.socialCollection.where({title:A.attributes.title}).length==0){s.socialCollection.add(A)}}})}if(a.isFunction(r)){r()}},error:function(t){if(a.isFunction(r)){r()}}})}else{if(a.isFunction(r)){r()}}},getPinterestCollection:function(q){var r=this;if(!h.isBlank(r.options.PinterestPageID)){r.pinRequestSuccess=false;var s=a.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=30&callback=?&q="+encodeURIComponent("https://www.pinterest.com/"+r.options.PinterestPageID+"/feed.rss"),dataType:"jsonp",success:function(w){if(w.responseData!=null){var t=w.responseData.feed.entries;var v=[];r.pinRequestSuccess=true;a.each(t,function(y,z){if(y<10){var x="<div>"+z.content+"</div>";var A="";var B=z.link.match(/\/pin\/(\d+)/);if(B!=null&&B.length==2){A=B[1];var C=new l({id:A,wallname:"pinterest",title:z.contentSnippet,image:((h.Device.detectGooglePageSpeedInsights())?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(a(x).find("img:first").attr("src").replace("236","736")):a(x).find("img:first").attr("src").replace("236","736")),description:z.contentSnippet,post_url:unescape(z.link),likecount:0,commentcount:0,posteddate:parseInt(new Date(z.publishedDate).getTime(),10),page_url:r.options.PinterestPageURL,isprime:false,istext:false,fbPoints:r.options.FacebookPoints,twitterPoints:r.options.TwitterPoints,linkedInPoints:r.options.LinkedInPoints});r.pinterestTempCollection.add(C);v.push(A)}}});var u=a.ajax({type:"GET",url:"https://api.pinterest.com/v3/pidgets/pins/info/?pin_ids="+v,dataType:"jsonp",success:function(y){var x=y.data;a.each(x,function(z,A){var B=r.pinterestTempCollection.where({id:A.id});if(B.length>0){B[0].set("likecount",A.like_count)}});r.pinterestTempCollection.each(function(B,z,A){if(r.socialCollection.where({title:B.attributes.title}).length==0){r.socialCollection.add(B)}});r.pinterestTempCollection.reset();r.removeLoadingSpinner();if(a.isFunction(q)){q()}},error:function(x){if(a.isFunction(q)){q()}}})}else{r.pinRequestSuccess=true;r.removeLoadingSpinner()}},error:function(t){if(a.isFunction(q)){q()}}})}else{if(a.isFunction(q)){q()}}},getGooglePlusCollection:function(r){var s=this;if(!h.isBlank(s.options.GooglePlusPageID)){var q="GooglePlusPageID="+s.options.GooglePlusPageID;s.gplusdata=new j.Collection([],{host:"websiteoutput",method:"GetGooglePlusClientFeedResponse",params:q,typefields:[{DataType:"BOCollection",Columns:"*"}]});s.gplusRequestSuccess=false;s.gplusdata.fetch({success:function(u,v){s.gplusRequestSuccess=true;var t=u.models;if(u!=undefined&&u!=null){a.each(t,function(x,y){var z=f;if(s.browserType=="ie8"){z=parseInt(new Date(y.get("published")).getTime(),10)}else{z=parseInt(new Date(y.get("published")).getTime(),10)}var w=new l({id:(!h.isBlank(y.get("id")))?y.get("id"):"",wallname:"googleplus",page_name:(!h.isBlank(y.get("actor")))?y.get("actor"):"",title:(!h.isBlank(y.get("title")))?y.get("title"):"",image:(!h.isBlank(y.get("image"))&&!h.isBlank(y.get("image")))?((h.Device.detectGooglePageSpeedInsights())?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(y.get("image")):y.get("image")):"",description:"",post_url:(!h.isBlank(y.get("url")))?unescape(y.get("url")):"",likecount:(!h.isBlank(y.get("likecount")))?y.get("likecount"):0,commentcount:(!h.isBlank(y.get("commentcount")))?y.get("commentcount"):0,posteddate:(!h.isBlank(z))?z:f,page_url:s.options.GooglePlusPageURL,isprime:false,istext:(a.trim(y.get("image"))==""&&a.trim(y.get("title"))!=""),fbPoints:s.options.FacebookPoints,twitterPoints:s.options.TwitterPoints,linkedInPoints:s.options.LinkedInPoints});if(s.socialCollection.where({title:w.attributes.title}).length==0){s.socialCollection.add(w)}});if(a.isFunction(r)){r()}s.removeLoadingSpinner()}},error:function(t){if(a.isFunction(r)){r()}}})}else{if(a.isFunction(r)){r()}}},getInstagramCollection:function(q){var r=this;if(!h.isBlank(r.options.InstagramPageID)){r.instaRequestSuccess=false;var s=a.ajax({type:"GET",url:"https://api.instagram.com/v1/users/"+r.options.InstagramPageID+"/media/recent/?client_id="+r.options.InstagramClientID,dataType:"jsonp",success:function(u){var t=u.data;r.instaRequestSuccess=true;a.each(t,function(v,x){var w=new l({id:"",wallname:"instagram",title:(!h.isBlank(x.caption))?x.caption.text:"",image:(!h.isBlank(x.images)&&!h.isBlank(x.images.standard_resolution))?((h.Device.detectGooglePageSpeedInsights())?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(x.images.standard_resolution.url):x.images.standard_resolution.url):"",description:"",post_url:(!h.isBlank(x.link))?unescape(x.link):"",likecount:(!h.isBlank(x.likes))?x.likes.count:0,commentcount:0,posteddate:(!h.isBlank(x.created_time))?parseInt(x.created_time*1000,10):f,page_url:r.options.InstagramPageURL,isprime:false,istext:false,fbPoints:r.options.FacebookPoints,twitterPoints:r.options.TwitterPoints,linkedInPoints:r.options.LinkedInPoints});if(r.socialCollection.where({title:w.attributes.title}).length==0){r.socialCollection.add(w)}});if(a.isFunction(q)){q()}r.removeLoadingSpinner()},error:function(t){if(a.isFunction(q)){q()}}})}else{if(a.isFunction(q)){q()}}},getYouTubeCollection:function(r){var s=this;if(!h.isBlank(s.options.YouTubePageID)){var q="YouTubePageID="+s.options.YouTubePageID;s.youtubedata=new j.Collection([],{host:"websiteoutput",method:"GetYouTubeChannelList",params:q,typefields:[{DataType:"BOCollection",Columns:"*"}]});s.youtubeRequestSuccess=false;s.youtubedata.fetch({success:function(t,u){s.youtubeRequestSuccess=true;if(t.length>0){var v=t.models;a.each(v,function(w,x){var y=f;if(s.browserType=="ie8"){y=parseInt(new Date(x.get("published")).getTime(),10)}else{y=parseInt(new Date(x.get("published")).getTime(),10)}var z=new l({id:(!h.isBlank(x.get("id")))?x.get("id"):"",wallname:"youtube",title:(!h.isBlank(x.get("title")))?x.get("title"):"",image:(!h.isBlank(x.get("image")))&&!h.isBlank(x.get("image"))?((h.Device.detectGooglePageSpeedInsights())?window.location.protocol+"//"+host.builder+"/_service/proxy.ashx?url="+encodeURIComponent(x.get("image")):x.get("image")):"",description:(!h.isBlank(x.get("description")))?x.get("description"):"",post_url:"https://www.youtube.com/watch?v="+x.get("id"),likecount:(!h.isBlank(x.get("likecount")))?x.get("likecount"):0,commentcount:(!h.isBlank(x.get("commentcount")))?x.get("commentcount"):0,posteddate:(!h.isBlank(y))?y:f,page_url:s.options.YouTubePageURL,isprime:false,istext:false,fbPoints:s.options.FacebookPoints,twitterPoints:s.options.TwitterPoints,linkedInPoints:s.options.LinkedInPoints});if(s.socialCollection.where({title:z.attributes.title}).length==0){s.socialCollection.add(z)}});if(a.isFunction(r)){r()}s.removeLoadingSpinner()}else{if(a.isFunction(r)){r()}}},error:function(t){if(a.isFunction(r)){r()}}})}else{if(a.isFunction(r)){r()}}},updateFBPhotos:function(){var q=this;q.$el.find(".facebook").each(function(t){var r=a(this).find(".itemImage:first");var u=a(r).attr("url");var w=u.split("_");var s="https://graph.facebook.com/"+w[1]+"?access_token=357097134310266|p9DAlPDufisPR-5o5KT1dtkhf44";var v=a.ajax({type:"GET",url:s,dataType:"jsonp",success:function(x){if(x.images!=null&&x.images.length>0){r.css("background-image","url("+x.images[0].source+")")}}})})},removeLoadingSpinner:function(){var q=this;if(q.fbRequestSuccess&&q.pinRequestSuccess&&q.instaRequestSuccess&&q.gplusRequestSuccess&&q.youtubeRequestSuccess&&q.twitterRequestSuccess){q.$el.find("#social-spinner").ActivityIndicator("destroy");q.$el.find("#social-spinner").hide()}},destroy:function(){var q=this}});var n=c.View.extend({tagName:"div",className:"item",template:p,defaultOptions:{model:null,SitePageModuleID:null,browserType:"",OwnerView:null},events:{},initialize:function(){var q=this;q.options=_.extend({},q.defaultOptions,q.options)},render:function(){var r=this;var s=r.model.toJSON();var q=_.template(r.template,s);r.$el.html(q).addClass(s.wallname);r.setCharacterLimit(q);r.browserSpecific();return r},setCharacterLimit:function(r){var s=this;var q=s.options.OwnerView.charCollection.where({id:s.options.OwnerView.options.RangeNumber});s.$el.html(r).addClass("regular");if(q.length>0){if(s.model.attributes.title.length>15){if(s.model.get("istext")){s.$el.html(r).addClass("text");s.$el.find(".postWrapper .postTitle").text(s.model.attributes.title.substring(0,q[0].attributes.NoPhotoText)+"...")}else{s.$el.find(".postWrapper .postTitle").text(s.model.attributes.title.substring(0,q[0].attributes.PhotoTextBlackBar)+"...");s.$el.find(".postWrapper .postFullTitle").text(s.model.attributes.title.substring(0,q[0].attributes.HoverPhototext)+"...")}}}},browserSpecific:function(){var q=this;if(q.options.browserType=="ie9"){q.$el.find(".shareIconsContainer").removeClass("visibilityNone")}},destroy:function(){var q=this}});return o});