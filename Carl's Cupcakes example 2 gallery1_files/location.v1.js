define("locationv1",["jquery","backbone","utility","data","map"],function(a,b,e,f,d){var c=b.View.extend({el:null,markers:[],defaultOptions:{SitePageModuleID:null,MapContainerID:null,ProjectID:null,StyleTypeID:0},initialize:function(){var h=this;h.options=_.extend({},h.defaultOptions,h.options);h.setElement(".mod-map-"+h.options.SitePageModuleID);var g="ProjectID="+h.options.ProjectID+"&SitePageModuleID="+h.options.SitePageModuleID;h.collection=new f.Collection([],{host:"websiteoutput",method:"GetLocation",params:g,typefields:[{DataType:"BusObj",Columns:"*"}]})},render:function(){var g=this;g.collection.fetch({success:function(j,k,h){if(g.collection.size()>0){g.loadMap()}},error:a.noop});return g},loadMap:function(){var g=this;switch(g.options.StyleTypeID){case 17427:g.markerImageUrl=window.location.protocol+"//"+host.wo["static"]+"/_css/_images/pin_black-resize-32x32.png";break;case 17428:g.markerImageUrl=window.location.protocol+"//"+host.wo["static"]+"/_css/_images/pin-white-resize-32x32.png";break;case 17430:g.markerImageUrl=window.location.protocol+"//"+host.wo["static"]+"/_css/_images/pin-green-32x32.png";break;case 17426:g.markerImageUrl=window.location.protocol+"//"+host.wo["static"]+"/_css/_images/pin-green-32x32.png";break;default:g.markerImageUrl=window.location.protocol+"//"+host.wo["static"]+"/_css/_images/pin-green-32x32.png";break}g.MapView=new d({el:g.$el.find(".map-canvas"),MapStyle:g.options.StyleTypeID,Marker:{url:g.markerImageUrl,size:{width:32,height:32}}});g.MapView.render();g.collection.each(function(j,h){g.markers.push(g.MapView.addMarker(j.toJSON()))});if(g.collection.size()===1){g.MapView.map.setZoom(15)}else{g.MapView.map.setZoom(g.getBoundsZoomLevel(g.$el.find(".map-canvas")))}require(["headerv1"],function(h){h.SetPointMarkerClass(a(".btn-direction").attr("id"))})},getBoundsZoomLevel:function(m){var n=this;var q={height:256,width:256};var r=19;var o=n.MapView.objBound.getNorthEast();var p=n.MapView.objBound.getSouthWest();var g=(n.latRad(o.lat())-n.latRad(p.lat()))/Math.PI;var j=o.lng()-p.lng();var k=((j<0)?(j+360):j)/360;var h=n.zoom(a(m).height(),q.height,g);var l=n.zoom(a(m).width(),q.width,k);return Math.min(h,l,r)},zoom:function(h,k,g){var j=this;return Math.floor(Math.log(h/k/g)/Math.LN2)},latRad:function(g){var h=this;var k=Math.sin(g*Math.PI/180);var j=Math.log((1+k)/(1-k))/2;return Math.max(Math.min(j,Math.PI),-Math.PI)/2}});return c});